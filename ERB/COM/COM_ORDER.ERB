;-------------------------------------------------
;커맨드를 실행할 수 있는가 판정의 처리
;-------------------------------------------------
;각 커맨드의 실행 판정도 이쪽으로 이식했습니다
;통상의 호출 외에 인수를 가지게 할 수가 있음.
;인수 1에 커맨드 번호를 넣으면, 지정한 커맨드의 실행 판정을 실행한다 (생략하면 SELECTCOM)
;인수 2에 1을 넣으면, 판정 결과를 표시하지 않는다 (생략하면 표시한다)
;인수 3에 1 이상을 넣었을 경우에는 이벤트 대사와 거부의 지문을 부르지 않는다(생략하면 부른다). 하지만 인수 2에서 표시할 때만 유효
;어느 경우에도 RESULT=1로 실행 가, =0으로 불가
;TFLAG:240 (구 A) = 기준값
;TFLAG:241 (구 V) = 실행값
;-------------------------------------------------
@COM_ORDER,ARG,ARG:1,ARG:2
SIF ARG <= 0
	ARG = SELECTCOM

TFLAG:240 = 0
LOCAL:99 = 0
RESULTS = 

;ABL:순종
IF ABL:10
	LOCAL:99 = ABL:10
	TFLAG:240 += LOCAL:99 * 4
	RESULTS = %RESULTS% %ABLNAME:10%LV{LOCAL:99}({LOCAL:99 * 4})
ENDIF
;ABL:새드끼
IF ABL:20
	RESULTS = %RESULTS% - 
	LOCAL:99 = ABL:20
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %ABLNAME:20%LV{LOCAL:99}({LOCAL:99})
ENDIF
;ABL:마조끼
IF ABL:21
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = ABL:21
	TFLAG:240 += LOCAL:99 * 2
	RESULTS = %RESULTS% %ABLNAME:21%LV{LOCAL:99}({LOCAL:99 * 2})
ENDIF

;ＢＬ조교 · 레즈 조교
IF (TALENT:PLAYER:120 && TALENT:120) || (TALENT:PLAYER:120 == 0 && TALENT:120 == 0)
	;ABL:레즈끼 · ＢＬ끼
	LOCAL = 22 + TALENT:120
	IF ABL:LOCAL
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = ABL:LOCAL
		TFLAG:240 += LOCAL:99 * 3
		RESULTS = %RESULTS% %ABLNAME:LOCAL%LV{LOCAL:99}({LOCAL:99 * 3})
	ENDIF
	;ABL:레즈중독 · ＢＬ중독
	LOCAL = 32 + TALENT:120
	IF ABL:LOCAL
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = ABL:LOCAL
		TFLAG:240 += LOCAL:99 * 3
		RESULTS = %RESULTS% %ABLNAME:LOCAL%LV{LOCAL:99}({LOCAL:99 * 3})
	ENDIF
	;TALENT:바이
	IF TALENT:83
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = 10
		TFLAG:240 += LOCAL:99
		RESULTS = %RESULTS% %TALENTNAME:83%({LOCAL:99})
	ENDIF
	;호기심
	IF TALENT:23
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = 8
		TFLAG:240 += LOCAL:99
		RESULTS = %RESULTS% %TALENTNAME:23%({LOCAL:99})
	ENDIF
	;보수적
	IF TALENT:24
		RESULTS = %RESULTS% - 
		LOCAL:99 = 15
		TFLAG:240 -= LOCAL:99
		RESULTS = %RESULTS% %TALENTNAME:24%({LOCAL:99})
	ENDIF
ELSE
	;호기심
	IF TALENT:23
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = 5
		TFLAG:240 += LOCAL:99
		RESULTS = %RESULTS% %TALENTNAME:23%({LOCAL:99})
	ENDIF
	;보수적
	IF TALENT:24
		RESULTS = %RESULTS% - 
		LOCAL:99 = 10
		TFLAG:240 -= LOCAL:99
		RESULTS = %RESULTS% %TALENTNAME:24%({LOCAL:99})
	ENDIF
ENDIF

;각인 체크
;고통각인
IF MARK:0
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = MARK:0
	TFLAG:240 += LOCAL:99 * 5
	RESULTS = %RESULTS% %MARKNAME:0%LV{LOCAL:99}({LOCAL:99 * 5})
ENDIF
;굴복각인
IF TALENT:16
	LOCAL:1 = 4
ELSEIF TALENT:17
	LOCAL:1 = 1
ELSE
	LOCAL:1 = 2
ENDIF
IF MARK:2
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = MARK:2
	TFLAG:240 += LOCAL:99 * 3 * LOCAL:1
	RESULTS = %RESULTS% %MARKNAME:2%LV{LOCAL:99}({LOCAL:99 * 3 * LOCAL:1})
ENDIF
;약물각인
IF MARK:3
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = MARK:3
	TFLAG:240 += LOCAL:99 * LOCAL:99
	RESULTS = %RESULTS% %MARKNAME:3%LV{LOCAL:99}({LOCAL:99 * LOCAL:99})
ENDIF
;치욕각인
IF MARK:4
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = MARK:4
	TFLAG:240 += LOCAL:99 * 2
	RESULTS = %RESULTS% %MARKNAME:4%LV{LOCAL:99}({LOCAL:99 * 2})
ENDIF
;공포각인
IF TALENT:10
	LOCAL:1 = 4
ELSEIF TALENT:12
	LOCAL:1 = 1
ELSE
	LOCAL:1 = 2
ENDIF
IF MARK:8
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = MARK:8
	TFLAG:240 += LOCAL:99 * 3 * LOCAL:1
	RESULTS = %RESULTS% %MARKNAME:8%LV{LOCAL:99}({LOCAL:99 * 3 * LOCAL:1})
ENDIF
;반발각인
IF MARK:9
	RESULTS = %RESULTS% - 
	LOCAL:99 = MARK:9
	TFLAG:240 -= LOCAL:99 * 2 * LOCAL:1
	RESULTS = %RESULTS% %MARKNAME:9%LV{LOCAL:99}({LOCAL:99 * 2 * LOCAL:1})
ENDIF

;PALAM:순종
GETPALAMLV PALAM:12, 5
LOCAL:2 = RESULT
IF LOCAL:2
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = LOCAL:2 * 3
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %PALAMNAME:12%LV{LOCAL:2}({LOCAL:99})
ENDIF
;PALAM:공포
GETPALAMLV PALAM:17, 5
LOCAL:2 = RESULT
IF LOCAL:2
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = LOCAL:2 * 3
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %PALAMNAME:17%LV{LOCAL:2}({LOCAL:99})
ENDIF

;반항적
IF TALENT:11
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:11%({LOCAL:99})
ENDIF
;꿋꿋함
IF TALENT:12
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:12%({LOCAL:99})
ENDIF
;素直
IF TALENT:13
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:13%({LOCAL:99})
ENDIF
;プライド高い
IF TALENT:16
	RESULTS = %RESULTS% - 
	LOCAL:99 = 15
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:16%({LOCAL:99})
;プライド低い
ELSEIF TALENT:17
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:17%({LOCAL:99})
ENDIF
;目立ちたがり
IF TALENT:28
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 2
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:28%({LOCAL:99})
ENDIF
;抑圧
IF TALENT:32
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:32%({LOCAL:99})
ENDIF
;抵抗
IF TALENT:34
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:34%({LOCAL:99})
ENDIF
;弱味
IF TALENT:39
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 12
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:39%({LOCAL:99})
ENDIF
;鬼(陥落していない)
IF TALENT:214 && (TALENT:150 + TALENT:151 + TALENT:152 + TALENT:153 + TALENT:160 + TALENT:161 + TALENT:162 + TALENT:164 + TALENT:167 + TALENT:168 + TALENT:169) == 0
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:214%({LOCAL:99})
;天狗(調教者が[鬼])
ELSEIF TALENT:215 && TALENT:PLAYER:214
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:215%({LOCAL:99})
;天狗(陥落していない)
ELSEIF TALENT:215 && (TALENT:150 + TALENT:151 + TALENT:152 + TALENT:153 + TALENT:160 + TALENT:161 + TALENT:162 + TALENT:164 + TALENT:167 + TALENT:168 + TALENT:169) == 0
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:215%({LOCAL:99})
ENDIF
;仙人(調教者が[死神])
IF TALENT:225 && TALENT:PLAYER:224
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:225%({LOCAL:99})
;死神(調教者が[仙人])
ELSEIF TALENT:224 && TALENT:PLAYER:225
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:224%({LOCAL:99})
ENDIF
;妄信
IF TALENT:151
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 8
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:151%({LOCAL:99})
ENDIF
;服従
IF TALENT:160
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:160%({LOCAL:99})
ENDIF
;烙印
IF TALENT:161
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:161%({LOCAL:99})
ENDIF
;隷属
IF TALENT:162
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:162%({LOCAL:99})
ENDIF
;傷物
IF TALENT:163
	SIF LOCAL:99
		RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:163%({LOCAL:99})
ENDIF
;使い魔
IF TALENT:164
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:164%({LOCAL:99})
ENDIF
;精神崩壊
;心が壊れ、何をするのか理解・認識しにくくなったため
IF TALENT:167
	SIF LOCAL:99
		RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:167%({LOCAL:99})
ENDIF
;傀儡
;ロボット化によりコマンド拒否不可能
IF TALENT:168
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 999
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:168%({LOCAL:99})
ENDIF
;壊造人格
;人格を破壊された揚句、都合のいいもの上書きされているのでコマンド拒否不可能
IF TALENT:169
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 999
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:169%({LOCAL:99})
ENDIF
;음란
IF TALENT:170
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:170%({LOCAL:99})
ENDIF
;즉각함락
IF TALENT:179
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:179%({LOCAL:99})
ENDIF

;수면 상태
;당연히 커맨드 거부 불가능
IF EQUIP:14
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 999
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 수면중({LOCAL:99})
ENDIF
;실신 상태
;당연히 커맨드 거부 불가능
IF TFLAG:899
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 999
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 실신중({LOCAL:99})
ENDIF
;蜘蛛の巣で拘束
;抵抗しにくくなるため
IF TEQUIP:40 == 7
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 거미집으로 구속({LOCAL:99})
ENDIF
;操りの糸
IF TEQUIP:77
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 마법의 실로 조종중({LOCAL:99})
ENDIF
;催眠状態
IF TEQUIP:92
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 최면상태({LOCAL:99})
ENDIF
;お香の効果(ジャスミンとフランキンセンス) なお、野外プレイ・お風呂場プレイ・特殊風呂プレイ中は効果なし
IF (TEQUIP:89 == 3 || TEQUIP:89 == 6) && TEQUIP:52 == 0 && TEQUIP:53 == 0 && TEQUIP:55 == 0
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 8
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 향기 효과({LOCAL:99})
ENDIF
;狂気の目発動中
IF TFLAG:152
	RESULTS = %RESULTS% - 
	LOCAL:99 = 15
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% 광기의 눈 방위중({LOCAL:99})
ENDIF
;奴隷が気力切れ
IF BASE:1 <= 0
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %조사처리(CALLNAME:TARGET,"가")% 기력 없음({LOCAL:99})
ENDIF

;조교자의 소질
;겁쟁이
IF TALENT:PLAYER:10
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %조사처리(CALLNAME:PLAYER,"가")% %TALENTNAME:10%({LOCAL:99})
ENDIF
;남자혐오
IF TALENT:PLAYER:37 && TALENT:120
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %조사처리(CALLNAME:PLAYER,"가")% %TALENTNAME:37%({LOCAL:99})
;여자혐오
ELSEIF TALENT:PLAYER:38 && TALENT:120 == 0
	RESULTS = %RESULTS% - 
	LOCAL:99 = 12
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %조사처리(CALLNAME:PLAYER,"가")% %TALENTNAME:38%({LOCAL:99})
ENDIF
;새드
IF TALENT:PLAYER:81
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 3
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %조사처리(CALLNAME:PLAYER,"가")% %TALENTNAME:81%({LOCAL:99})
ENDIF
;매혹
IF TALENT:PLAYER:91
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 6
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %조사처리(CALLNAME:PLAYER,"가")% %TALENTNAME:91%({LOCAL:99})
ENDIF
;수수께끼의 매력
IF TALENT:PLAYER:92
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 6
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %조사처리(CALLNAME:PLAYER,"가")% %TALENTNAME:92%({LOCAL:99})
ENDIF
;小悪魔
IF TALENT:PLAYER:93
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = (TALENT:PLAYER:130 || TALENT:PLAYER:131 || TALENT:PLAYER:159) ? 8 # 6
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %조사처리(CALLNAME:PLAYER,"가")% %TALENTNAME:93%({LOCAL:99})
ENDIF
;大乳導
IF TALENT:PLAYER:96 && (TALENT:112 || TALENT:113)
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 8
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %조사처리(CALLNAME:PLAYER,"가")% %TALENTNAME:96%({LOCAL:99})
;つるぺた堕し
ELSEIF TALENT:PLAYER:97 && (TALENT:110 || TALENT:111)
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 8
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %조사처리(CALLNAME:PLAYER,"가")% %TALENTNAME:97%({LOCAL:99})
ENDIF
;調教者が気力切れ
IF BASE:PLAYER:1 <= 0
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %조사처리(CALLNAME:PLAYER,"가")% 기력없음({LOCAL:99})
ENDIF

;助手の素質
;嫉妬しやすい
IF ASSIPLAY && TALENT:PLAYER:19
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %조사처리(CALLNAME:PLAYER,"가")% %TALENTNAME:19%({LOCAL:99})
ENDIF
;고무
IF ASSIPLAY && TALENT:PLAYER:95
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 1
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %조사처리(CALLNAME:PLAYER,"가")% %TALENTNAME:95%({LOCAL:99})
ENDIF

;상성 체크(상성 보통일 때는 표시하지 않게 했음)
LOCAL:3 = TRAIN_RELATION_CALC(PLAYER)
IF LOCAL:3 == 0 || LOCAL:3 == 100
;	SIF LOCAL:99
;		RESULTS = %RESULTS% + 
;	RESULTS = %RESULTS% 상성 보통(0)
ELSEIF LOCAL:3 < 30
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% 상성최악({LOCAL:99})
ELSEIF LOCAL:3 < 70
	RESULTS = %RESULTS% - 
	LOCAL:99 = 6
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% 상성나쁨({LOCAL:99})
ELSEIF LOCAL:3 < 100
	RESULTS = %RESULTS% - 
	LOCAL:99 = 3
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% 상성보통({LOCAL:99})
ELSEIF LOCAL:3 < 130
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 3
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 상성조금좋음({LOCAL:99})
ELSEIF LOCAL:3 < 170
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 6
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 상성좋음({LOCAL:99})
ELSE
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 상성최고({LOCAL:99})
ENDIF

;난이도(PHANTASM이라면 -20, LUNATIC이라면 -10, HARD라면 -5, EASY라면 +5 실행 판정에 더한다)
IF FLAG:3 == 5
	RESULTS = %RESULTS% - 
	LOCAL:99 = 20
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% PHANTASM({LOCAL:99})
ELSEIF FLAG:3 == 4
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% LUNATIC({LOCAL:99})
ELSEIF FLAG:3 == 3
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% HARD({LOCAL:99})
ELSEIF FLAG:3 == 2
;	SIF LOCAL:99
;		RESULTS = %RESULTS% + 
;	LOCAL:99 = 0
;	TFLAG:240 += LOCAL:99
;	RESULTS = %RESULTS% NORMAL({LOCAL:99})
;	LOCAL:99 = 1
ELSEIF FLAG:3 == 1
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% EASY({LOCAL:99})
ENDIF

;YASAI
IF TALENT:PLAYER:831 && TEQUIP:78
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	IF TEQUIP:78 == 2
		RESULTS = %RESULTS% Ph모드({LOCAL:99})
	ELSEIF TEQUIP:78 == 1
		RESULTS = %RESULTS% Ex모드({LOCAL:99})
	ENDIF
ENDIF
;Debug
IF TALENT:MASTER:998
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 디버그모드({LOCAL:99})
ENDIF

LOCAL = 0
TRYCALLFORM COM_ORDER_{ARG},LOCAL:99
RESULTS = %RESULTS% = {TFLAG:240}
IF TFLAG:240 < TFLAG:241
	LOCAL = 0
	RESULTS = %RESULTS% < 
ELSEIF TFLAG:240 == TFLAG:241
	LOCAL = 1
	RESULTS = %RESULTS% = 
ELSE
	LOCAL = 1
	RESULTS = %RESULTS% > 
ENDIF

;원 소스는 <= 이었으나, < 로 수정하였다. (131019_밴디트킹)
IF ARG:1 <= 0
	PRINTFORMW %RESULTS% 실행치 {TFLAG:241}
  ;설정에 따라 표시여부가 결정나는 것이 원 의도였던 것 같은데 실행치가 아예 표시가 되지 않는지라 일단 원상복귀해둠
	;반항 인터럽트. 토리코모드 사양. 인터럽트 시스템 필요.
	IF FLAG:5000 & 512
		;디버그
		;PRINTFORML 거부체크 시작...CALL CHECK_DENIAL_TOFORCE_TORIKOMODE, TFLAG:240, TFLAG:241  {TFLAG:240} {TFLAG:241}
		CALL CHECK_DENIAL_TOFORCE_TORIKOMODE, TFLAG:240, TFLAG:241
		;결과치가 1이면 실행가능으로 바뀐다.
		SIF RESULT == 1
			LOCAL = 1
	ENDIF
	;거부당했을 때의 지문 · 대사
	IF LOCAL == 0 && ARG:2 < 1
		CALL SELF_KOJO, TARGET, 1
		TRYCALLFORM DENIAL_MESSAGE_COM_{ARG}

		CALL DENIAL_PALAM_MOVE
	ENDIF
ENDIF

RETURN LOCAL

;-------------------------------------------------
;커맨드를 실행할 수 없었을 때의 패러미터 변동 처리
;-------------------------------------------------
@DENIAL_PALAM_MOVE
LOCAL = (TFLAG:241 - TFLAG:240) * 40

;난이도를 본다
IF FLAG:3 == 1
	TIMES LOCAL , 0.50
ELSEIF FLAG:3 == 2
	TIMES LOCAL , 1.00
ELSEIF FLAG:3 == 3
	TIMES LOCAL , 1.20
ELSEIF FLAG:3 == 4
	TIMES LOCAL , 1.50
ELSE
	TIMES LOCAL , 2.00
ENDIF

;MARK:반발각인
IF MARK:9 == 0
	TIMES LOCAL , 0.75
ELSEIF MARK:9 == 1
	TIMES LOCAL , 1.00
ELSEIF MARK:9 == 2
	TIMES LOCAL , 1.25
ELSE
	TIMES LOCAL , 1.50
ENDIF

;MARK:공포각인
IF MARK:8 == 0
	TIMES LOCAL , 0.75
ELSEIF MARK:8 == 1
	TIMES LOCAL , 1.00
ELSEIF MARK:8 == 2
	TIMES LOCAL , 1.25
ELSE
	TIMES LOCAL , 1.50
ENDIF

;ABL:순종을 본다
IF ABL:10 == 0
	TIMES LOCAL , 1.00
ELSEIF ABL:10 == 1
	TIMES LOCAL , 0.80
ELSEIF ABL:10 == 2
	TIMES LOCAL , 0.70
ELSEIF ABL:10 == 3
	TIMES LOCAL , 0.50
ELSEIF ABL:10 == 4
	TIMES LOCAL , 0.30
ELSE
	TIMES LOCAL , 0.10
ENDIF

;함락해 있으면 줄인다
SIF TALENT:150 || TALENT:160 || TALENT:170
	TIMES LOCAL , 0.70

PALAM:20 = LIMIT (PALAM:20+LOCAL, 0, 99999999)

;-------------------------------------------------
;실행 판정 중의 불결 계산 처리
;-------------------------------------------------
;ARG   = 참조하는 불결의 부위
;ARG:1 = 1 이상이라면 피 및 점액의 불결도 참조한다. 그렇지 않으면 패스한다.
@COMORDER_STAIN_CALC(ARG, ARG:1)
#FUNCTION
RESULT = 0
;애액의 불결
SIF STAIN:PLAYER:ARG & 1
	RESULT += 1
;정액의 불결
SIF STAIN:PLAYER:ARG & 4
	RESULT += 3
;애널의 불결
SIF STAIN:PLAYER:ARG & 8
	RESULT += 7
;모유의 불결
SIF STAIN:PLAYER:ARG & 16
	RESULT += 15
;피(파과)의 불결
SIF ARG:1 >= 1 && STAIN:PLAYER:ARG & 32
	RESULT += 2
;점액의 불결
SIF ARG:1 >= 1 && STAIN:PLAYER:ARG & 64
	RESULT += 8

;냄새둔감
SIF TALENT:61
	RESULT /= 3
;냄새민감
SIF TALENT:62
	RESULT *= 2

RETURNF RESULT
